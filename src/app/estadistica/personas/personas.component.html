<h2 class="text-center">Expedientes de Pacientes</h2>
<div class=" mt-3">

  <div *ngIf="porcentajeDeProgreso >= 0" class="d-flex justify-content-center">
    <div aria-label="Orange and tan hamster running in a metal wheel" role="img" class="wheel-and-hamster">
      <div class="wheel"></div>
      <div class="hamster">
        <div class="hamster__body">
          <div class="hamster__head">
            <div class="hamster__ear"></div>
            <div class="hamster__eye"></div>
            <div class="hamster__nose"></div>
          </div>
          <div class="hamster__limb hamster__limb--fr"></div>
          <div class="hamster__limb hamster__limb--fl"></div>
          <div class="hamster__limb hamster__limb--br"></div>
          <div class="hamster__limb hamster__limb--bl"></div>
          <div class="hamster__tail"></div>
        </div>
      </div>
      <div class="spoke"></div>
    </div>
  </div>


<hr class="my-0 p-1">
  <div class="search-container">
    <div class="rounded p-2 bg-dark">
      <form class="search-form" autocomplete="off" >
        <input type="text" class="form-control search-input" name="expediente" placeholder="Expediente" [(ngModel)]="expedienteBuscar" />
        <input type="text" class="form-control search-input" placeholder="Nombre" name="nombreBuscar" [(ngModel)]="nombreBuscar" />
        <input type="text" class="form-control search-input" name="apellidoBuscar" [(ngModel)]="apellidoBuscar" />
        <input type="text" class="form-control search-input" placeholder="DPI" name="dpiBuscar" [(ngModel)]="dpiBuscar" />
        <button type="submit" class="btn btn-primary search-button" (click)="filtro()">
          <searchIcon />
        </button>
        <button type="button" class="btn btn-secondary search-button" (click)="limpiarInput()">
          <deleteInput />
        </button>

      </form>


    </div>
  </div>

  <div *ngIf="porcentajeDeProgreso >= 0" class="progress">
    <div class="progress-bar progress-bar-striped progress-bar-animated bg-quatz text-light"
         role="progressbar"
         [style.width.%]="porcentajeDeProgreso"
         [attr.aria-valuenow]="porcentajeDeProgreso"
         aria-valuemin="0"
         aria-valuemax="100">
     <strong class="">C o m p l e t a d o</strong>
    </div>
  </div>




  <div class="custom-table-wrapper t-w-d mt-3">
    <!-- <table class="table table-hover table-black table-borderless fs-5 " aria-labelledby="tableLabel" *ngIf="pacientes.length > 0"> -->
    <table class="custom-table table-hover text-center ">
      <thead class="text-normal">
        <tr>

          <th class="text-center bg-aqua" (click)="sortTable('expediente')">Expediente</th>
          <th class="text-center bg-aqua" (click)="sortTable('nombre')">Paciente</th>
          <th class="text-center bg-aqua" (click)="sortTable('dpi')">DPI</th>
          <th class="text-center bg-aqua" (click)="sortTable('sexo')">Sexo</th>
          <th class="text-center bg-aqua" (click)="sortTable('nacimiento')">Fecha Nacimiento</th>
          <th class="text-center bg-aqua" (click)="sortTable('estado')">Direccion</th>

        </tr>
      </thead>

      <tbody class="justify-content-center  opacity-90 ">
        <tr *ngFor="let paciente of filteredPacientes">

          <td class="font-title text-center text-warning" (click)="abrirModal(paciente)" data-bs-toggle="modal" data-bs-target="#ver">
            <span>
              <dataViewIcon />
              {{ paciente.expediente }}
          </span>
          </td>

          <td class="text-center text-justify " appHighlightWords >
            <span [ngClass]="{'mujer': paciente.sexo == 'F', 'hombre': paciente.sexo != 'F'}">{{ paciente.nombre | capitalizeName }}</span> <br>
            {{ paciente.apellido | capitalizeName }}
            <span *ngIf="paciente.gemelo == 'si'" class="f-negrita bg-black p-1 rounded">
              <gemeloIcon />
            </span>
          </td>
          <td class="text-center">{{ paciente.dpi | anyToText | formatoDPI }}</td>
          <td class="text-center">
            <ng-container *ngIf="paciente.sexo == 'F'; else man">

              <femIcon />
            </ng-container>

            <ng-template #man>
              <ng-container *ngIf="paciente.sexo == 'M'; else NoneBl">
               <maleIcon />
              </ng-container>
            </ng-template>

            <ng-template #NoneBl>
              <span class="text-warning">SIn Registrar !!!</span>
              <atentionIcon />
            </ng-template>


          </td>
          <td class="text-center">{{ paciente.nacimiento | anyToText | formatoFecha}}</td>
          <td class="text-center">{{ paciente.direccion | anyToText | capitalizeName}}, {{paciente.municipio | anyToNumber | enumMunicipio}}, {{paciente.depto |anyToNumber | enumDepto}}</td>

        </tr>
      </tbody>
    </table>
  </div>



<!-- Paginación -->
  <div class="d-flex justify-content-center pagination mt-3">
    <div class="btn-group" [class.disabled]="paginaActual === 1" *ngIf="totalPaginas()">
      <button type="button" class="btn btn-secondary" (click)="onPageChange(1)" aria-label="Primera">Primera</button>
      <button type="button" class="btn btn-secondary" (click)="onPageChange(paginaActual - 1)" aria-label="Anterior">Anterior</button>
      <button type="button" class="btn btn-secondary" (click)="onPageChange(paginaActual + 1)" aria-label="Siguiente">Siguiente</button>
      <button type="button" class="btn btn-secondary" (click)="onPageChange(totalPaginas())" aria-label="Última">Última</button>
    </div>
  </div>
</div>


<div class="modal fade" id="formularioModal" tabindex="-1" aria-labelledby="formularioModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-terce">
        <h5 class="modal-title " id="formularioModalLabel">Busqueda Avanzada</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <form class="d-flex justify-content-center align-items-center">
          <input type="sumit" class="form-control rounded text-capitalize mx-1 " placeholder="nombre" name="nombreBuscar" [(ngModel)]="nombreBuscar">
          <input type="text" class="form-control  rounded text-capitalize mx-1" placeholder="apellido" name="apellidoBuscar" [(ngModel)]="apellidoBuscar">
          <input type="text" class="form-control rounded mx-1" placeholder="DPI" name="dpiBuscar" [(ngModel)]="dpiBuscar">
          <button type="submit" class="btn btn-outline-primary " data-bs-dismiss="modal" (click)="buscarPacientes()">buscar</button>
        </form>
        <form>

        </form>

      </div>

      <div class="modal-footer">

      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="ver" tabindex="-1" aria-labelledby="formModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content card bg-night">
      <!-- Encabezado del modal con botón de cierre -->
      <div class="modal-header">
        <h5 class="modal-title text-center w-100">
          Detalles del Expediente: <span class="font-fam">{{ patient?.expediente }}</span>
        </h5>
        <button type="button" class="btn-close btn-light" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Cuerpo del modal -->
    <div class="modal-body code-container" id="code">
      <div class="modal-body mx-3 mx-md-5 font-monospace">
        <div class="text-start">
          <p>&#123;</p>
            <!-- Contenido del modal -->
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0">Nombre: </span>
              <p class="font-value m-0">{{ patient?.nombre | anyToText | capitalizeName }},</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Apellido: </span>
              <p class="font-value m-0 m-0">{{ patient?.apellido | anyToText | capitalizeName }},</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Fecha de nacimiento: </span>
              <p class="font-value m-0 m-0">{{ patient?.nacimiento | anyToText | formatoFecha }},</p>
            </div>
            <div *ngIf="patient?.fechaDefuncion" class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Fecha defuncion: </span>
              <p class="font-value m-0 m-0">{{ patient?.fechaDefuncion | anyToText | formatoFecha }}</p>
              <deadIcon/>,
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Edad: </span>
              <p class="font-value m-0 m-0">{{ patient?.nacimiento | edad }},</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Sexo: </span>
              <p class="font-value m-0 m-0">{{ patient?.sexo | anyToText | sexo }}</p>
              <ng-container *ngIf="patient?.sexo == 'F'; else man">

                <femIcon/>
               </ng-container>

               <ng-template #man>
                 <ng-container *ngIf="patient?.sexo == 'M'; else NoneBl">
                   <maleIcon/>
                 </ng-container>
               </ng-template>

               <ng-template #NoneBl>

                 <span class="text-warning">SIn Registrar !!!</span>
               </ng-template> ,
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">DPI: </span>
              <p class="font-value m-0 m-0">{{ patient?.dpi | anyToText | formatoDPI }},</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Nacionalidad: </span>
              <p class="font-value m-0 m-0">{{ patient?.nacionalidad | anyToNumber | enumNacion }},</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Lugar de Nacimiento: </span>
              <p class="font-value m-0 m-0">{{ patient?.lugar_nacimiento | anyToNumber | enumVecindad }},</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Estado civil: </span>
              <p class="font-value m-0 m-0">{{ patient?.estado_civil | anyToNumber | enumCivil }},</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Ocupación: </span>
              <p class="font-value m-0 m-0">{{ patient?.ocupacion | anyToText | capitalizeName}},</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Nivel Academico: </span>
              <p class="font-value m-0 m-0">{{ patient?.educacion | anyToNumber | enumEducacion }},</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Dirección: </span>
              <p class="font-value m-0 m-0">{{ patient?.direccion | anyToText | capitalizeName }}, {{patient?.municipio | anyToNumber | enumMunicipio | capitalizeName}}, <br> {{patient?.depto | anyToNumber | enumDepto | capitalizeName}},</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Telefonos: </span>
              <p class="font-value m-0 m-0">{{ patient?.telefono }} - {{ patient?.telefono_responsable }} ,</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Conyugue: </span>
              <p class="font-value m-0 m-0">{{ patient?.conyugue | anyToText | capitalizeName }} ,</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Responsable: </span>
              <p class="font-value m-0 m-0">{{ patient?.responsable | anyToText | capitalizeName }} ,</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Parentesco: </span>
              <p class="font-value m-0 m-0">{{ patient?.parentesco | anyToNumber | enumParentesco }} ,</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">DPI de responsable: </span>
              <p class="font-value m-0 m-0">{{ patient?.dpi_responsable | anyToText | formatoDPI }} ,</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Madre: </span>
              <p class="font-value m-0 m-0">{{ patient?.madre | anyToText | capitalizeName }} ,</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Padre: </span>
              <p class="font-value m-0 m-0">{{ patient?.padre | anyToText | capitalizeName }} ,</p>
            </div>
            <div class="etiqueta-modal">
              <span class="me-1 font-title m-0 m-0">Creado por: </span>
              <p class="font-value m-0 m-0">{{ patient?.created_by }} ,</p>
            </div>
            <p>&#125;</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
