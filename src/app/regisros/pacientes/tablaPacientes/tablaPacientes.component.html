<app-registros></app-registros>

<div>
  <div class=" mt-1">
    <p class="text-center h2 p-0 text-light">Lista de Pacientes</p>

    <div *ngIf="porcentajeDeProgreso >= 0" class="d-flex justify-content-center">
      <div aria-label="Orange and tan hamster running in a metal wheel" role="img" class="wheel-and-hamster">
        <div class="wheel"></div>
        <div class="hamster">
          <div class="hamster__body">
            <div class="hamster__head">
              <div class="hamster__ear"></div>
              <div class="hamster__eye"></div>
              <div class="hamster__nose"></div>
            </div>
            <div class="hamster__limb hamster__limb--fr"></div>
            <div class="hamster__limb hamster__limb--fl"></div>
            <div class="hamster__limb hamster__limb--br"></div>
            <div class="hamster__limb hamster__limb--bl"></div>
            <div class="hamster__tail"></div>
          </div>
        </div>
        <div class="spoke"></div>
      </div>
    </div>




  <div class="search-container">
    <div class="search-div">
      <form class="search-form" autocomplete="off">
        <!-- Campos de búsqueda -->
        <input
          type="text"
          class="search-input form-control"
          name="expediente"
          placeholder="Expediente"
          [(ngModel)]="expedienteBuscar"
        />
        <input
          type="text"
          class="search-input form-control"
          placeholder="Nombre"
          name="nombreBuscar"
          [(ngModel)]="nombreBuscar"
        />
        <input
          type="text"
          class="search-input form-control"
          placeholder="Apellido"
          name="apellidoBuscar"
          [(ngModel)]="apellidoBuscar"
        />
        <input
        class="search-input form-control"
          type="text"
          placeholder="DPI"
          name="dpiBuscar"
          [(ngModel)]="dpiBuscar"
        />

        <div class="d-flex gap-1">
          <searchIcon (click)="filtro()"/>


          <deleteInput (click)="limpiarInput()"/>


          <createIcon data-bs-toggle="modal" data-bs-target="#formularioModalP" />

        </div>

      </form>
    </div>
  </div>

    <div *ngIf="porcentajeDeProgreso >= 0" class="progress">
      <div class="progress-bar progress-bar-striped progress-bar-animated bg-quatz text-light"
           role="progressbar"
           [style.width.%]="porcentajeDeProgreso"
           [attr.aria-valuenow]="porcentajeDeProgreso"
           aria-valuemin="0"
           aria-valuemax="100">
       <strong class="">C o m p l e t a d o</strong>
      </div>
    </div>



    <div class="custom-table-wrapper t-w-d mt-3">
      <table class="custom-table table-hover text-center">
        <thead class="text-normal">
          <tr>


            <th ></th>
            <th  (click)="sortTable('expediente')">Expediente</th>
            <th  (click)="sortTable('sexo')">Sexo</th>
            <th  (click)="sortTable('nombre')">Paciente</th>
            <th  (click)="sortTable('dpi')">DPI</th>
            <th  (click)="sortTable('nacimiento')">Edad</th>
            <th  (click)="sortTable('nacimiento')">Fecha Nacimiento</th>
            <th  (click)="sortTable('estado')">Estado</th>
            <th  (click)="sortTable('id')">ID</th>
          </tr>
        </thead>

        <tbody class="justify-content-center  opacity-90 ">
          <tr *ngFor="let paciente of filteredPacientes">
            <td>
              <div class="column.block">

                  <babyFootIcon *ngIf="paciente.sexo === 'F' && calcularEdad(paciente.nacimiento) > 12 && calcularEdad(paciente.nacimiento) < 50" [routerLink]="['/rn/', paciente.expediente]" />

                  <editIcon [routerLink]="['/paciente/edit', paciente.id]" />

              </div>
            </td>

            <td class="font-title text-center text-warning" (click)="abrirModal(paciente)" data-bs-toggle="modal" data-bs-target="#ver">
              <span>
                <dataViewIcon />
              {{ paciente.expediente }}
            </span>
            </td>
            <td class="text-center">
              <ng-container *ngIf="paciente.sexo == 'F'; else man">
               <femIcon/>
              </ng-container>
              <ng-template #man>
                <ng-container *ngIf="paciente.sexo == 'M'; else NoneBl">
                  <maleIcon/>
                </ng-container>
              </ng-template>
              <ng-template #NoneBl>
                <span class="text-warning">SIn Registrar !!!</span>
                <atentionIcon />
              </ng-template>
            </td>
            <td class="text-center text-justify " appHighlightWords >
              <span [ngClass]="{'mujer': paciente.sexo == 'F', 'hombre': paciente.sexo != 'F'}">{{ paciente.nombre | capitalizeName }}</span> <br>
              {{ paciente.apellido | capitalizeName }}
              <span *ngIf="paciente.gemelo == 'si'" class="f-negrita bg-black p-1 rounded">
                <gemeloIcon />
              </span>
            </td>

            <td class="text-center">{{ paciente.dpi | anyToText | formatoDPI }}</td>

            <td class="text-center">{{ paciente.nacimiento | edad }}</td>
            <td class="text-center">{{ paciente.nacimiento | anyToText | formatoFecha}}</td>
            <td class="text-center">
              <ng-container *ngIf="paciente.estado === 'v'; else dead">
                <beatIcon/>
              </ng-container>
              <ng-template #dead>
                <deadIcon/>
              </ng-template>
            </td>
            <td class="small">{{ paciente.id }}</td>
          </tr>
        </tbody>
      </table>
    </div>



  <!-- Paginación -->
    <div class="d-flex justify-content-center pagination mt-3">
      <div class="btn-group" [class.disabled]="paginaActual === 1" *ngIf="totalPaginas()">
        <button type="button" class="btn btn-secondary" (click)="onPageChange(1)" aria-label="Primera">Primera</button>
        <button type="button" class="btn btn-secondary" (click)="onPageChange(paginaActual - 1)" aria-label="Anterior">Anterior</button>
        <button type="button" class="btn btn-secondary" (click)="onPageChange(paginaActual + 1)" aria-label="Siguiente">Siguiente</button>
        <button type="button" class="btn btn-secondary" (click)="onPageChange(totalPaginas())" aria-label="Última">Última</button>
      </div>
    </div>
  </div>




  <div class="modal" id="formularioModalP">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Formulario de Creación de Pacientes</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true"></span>
          </button>
        </div>
        <div class="modal-body">
      <formulario-paciente></formulario-paciente>
        </div>
        <div class="modal-footer">
          <!-- <button type="button" class="btn btn-primary">Save changes</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
        </div>
      </div>
    </div>
  </div>



  <div class="modal fade" id="ver" tabindex="-1" aria-labelledby="formModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content card bg-night">
        <!-- Encabezado del modal con botón de cierre -->
        <div class="modal-header">
          <h5 class="modal-title text-center w-100">
            Detalles del Expediente: <span class="font-fam">{{ patient?.expediente }}</span>
          </h5>
          <button type="button" class="btn-close btn-light" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <!-- Cuerpo del modal -->
      <div class="modal-body code-container" id="code">
        <div class="modal-body mx-3 mx-md-5 font-monospace">
          <div class="text-start">
            <p>&#123;</p>
              <!-- Contenido del modal -->
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0">Nombre: </span>
                <p class="font-value m-0">{{ patient?.nombre | anyToText | capitalizeName }},</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Apellido: </span>
                <p class="font-value m-0 m-0">{{ patient?.apellido | anyToText | capitalizeName }},</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Fecha de nacimiento: </span>
                <p class="font-value m-0 m-0">{{ patient?.nacimiento | anyToText | formatoFecha }},</p>
              </div>
              <div *ngIf="patient?.fechaDefuncion" class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Fecha defuncion: </span>
                <p class="font-value m-0 m-0">{{ patient?.fechaDefuncion | anyToText | formatoFecha }}</p>
                <deadIcon/>,
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Edad: </span>
                <p class="font-value m-0 m-0">{{ patient?.nacimiento | edad }},</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Sexo: </span>
                <p class="font-value m-0 m-0">{{ patient?.sexo | anyToText | sexo }}</p>
                <ng-container *ngIf="patient?.sexo == 'F'; else man">

                  <femIcon/>
                 </ng-container>

                 <ng-template #man>
                   <ng-container *ngIf="patient?.sexo == 'M'; else NoneBl">
                     <maleIcon/>
                   </ng-container>
                 </ng-template>

                 <ng-template #NoneBl>

                   <span class="text-warning">SIn Registrar !!!</span>
                 </ng-template> ,
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">DPI: </span>
                <p class="font-value m-0 m-0">{{ patient?.dpi | anyToText | formatoDPI }},</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Nacionalidad: </span>
                <p class="font-value m-0 m-0">{{ patient?.nacionalidad | anyToNumber | enumNacion }},</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Lugar de Nacimiento: </span>
                <p class="font-value m-0 m-0">{{ patient?.lugar_nacimiento | anyToNumber | enumVecindad }},</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Estado civil: </span>
                <p class="font-value m-0 m-0">{{ patient?.estado_civil | anyToNumber | enumCivil }},</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Ocupación: </span>
                <p class="font-value m-0 m-0">{{ patient?.ocupacion | anyToText | capitalizeName}},</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Nivel Academico: </span>
                <p class="font-value m-0 m-0">{{ patient?.educacion | anyToNumber | enumEducacion }},</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Dirección: </span>
                <p class="font-value m-0 m-0">{{ patient?.direccion | anyToText | capitalizeName }}, {{patient?.municipio | anyToNumber | enumMunicipio | capitalizeName}}, <br> {{patient?.depto | anyToNumber | enumDepto | capitalizeName}},</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Telefonos: </span>
                <p class="font-value m-0 m-0">{{ patient?.telefono }} - {{ patient?.telefono_responsable }} ,</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Conyugue: </span>
                <p class="font-value m-0 m-0">{{ patient?.conyugue | anyToText | capitalizeName }} ,</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Responsable: </span>
                <p class="font-value m-0 m-0">{{ patient?.responsable | anyToText | capitalizeName }} ,</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Parentesco: </span>
                <p class="font-value m-0 m-0">{{ patient?.parentesco | anyToNumber | enumParentesco }} ,</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">DPI de responsable: </span>
                <p class="font-value m-0 m-0">{{ patient?.dpi_responsable | anyToText | formatoDPI }} ,</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Madre: </span>
                <p class="font-value m-0 m-0">{{ patient?.madre | anyToText | capitalizeName }} ,</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Padre: </span>
                <p class="font-value m-0 m-0">{{ patient?.padre | anyToText | capitalizeName }} ,</p>
              </div>
              <div class="etiqueta-modal">
                <span class="me-1 font-title m-0 m-0">Creado por: </span>
                <p class="font-value m-0 m-0">{{ patient?.created_by }} ,</p>
              </div>
              <p>&#125;</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
